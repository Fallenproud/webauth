= Vert.x FIDO2 webauthn for web applications
:author: Paulo Lopes <pmlopes@gmail.com>
:toc:

This how to will show you how to build and secure a simple web vert.x application with FIDO2 (commonly known as Web Authentication API). The Web Authentication API (also known as WebAuthn) is a specification written by the W3C and FIDO, with the participation of Google, Mozilla, Microsoft, Yubico, and others. The API allows servers to register and authenticate users using public key cryptography instead of a password.


== What you will build

By the end of this how-to, you will have a working application that requires or stores passwords to perform authentication. This will be achieved with WebAuthn, which is a new W3C global standard for secure authentication on the Web supported by all leading browsers and platforms.


== What you need

* A text editor or IDE
* Java 8 or higher (11 or >=15 recommended for the extra security algorithms)
* Internet access


== Create a project

Go to start.vertx.io and https://start.vertx.io/starter.zip?groupId=howto&artifactId=oauth-oidc&vertxDependencies=vertx-web&vertx-auth-webauthn[create a project] with the following dependencies:

* Vert.x Web
* Webauthn Auth

image::project.png[width=600]


== Security first

Web Authentication API is a secure API and vendors decided to follow the best practices. While you can build a server without using SSL, modern web browsers will not connect or allow the usage of the webauthn APIs with servers not using SSL, even during development.

Before we can start using webauthn we will need to ensure that even our development application is SSL ready. For this we need to create a valid SSL certificate. Do note that self signed certificates are still allowed:

To create a self-signed certificate for your IP address do the following:

[source,bash]
----
keytool \
  -genkeypair \
  -alias rsakey \
  -keyalg rsa \
  -storepass passphrase \      # <1>
  -keystore mytestkeys.jks \
  -storetype JKS \
  -dname "CN=192.168.178.74.xip.io,O=Vert.x Development" # <2>
----
<1> Don't use this password!
<2> replace the CN with your own IP address (other than localhost) with suffix .xip.io

For this setup we're relying on a "free" DNS server that returns your IP address when queried. Other services exist in the web that provide the same results, for example:

* https://sslip.io/
* https://nip.io/

At this moment we have a SSL certificate, however the format is considered deprecated for modern Java versions, so we need a second step to convert it to `PKCS#12`:

[source,bash]
----
keytool \
  -importkeystore \
  -srckeystore mytestkeys.jks \
  -destkeystore mytestkeys.jks \
  -deststoretype pkcs12
----

Your new SSL certificate is on the file `mytestkeys.jks`.


== Implementation sections

- Make one or multiple sections to show the implementation.
- Make use of Asciidoc source code comments to highlight specific parts of the code.
- The code must be included using https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#source-code[Asciidoc directives]. Remember that you can include fragments of code by using delimiter tags.

== Running the application

- Always show the various options to run the application.

== Summary

- Briefly recapitulate what was covered and learned in the how-to.

== See also

- If possible, link to other how-tos.
- If judicious, link to Vert.x or third-party documentation.
