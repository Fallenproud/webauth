<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Vert.x FIDO2 webauthn for web applications | Eclipse Vert.x how-to</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
    crossorigin="anonymous">
  <link rel="icon" type="image/svg+xml" href="assets/images/vertx-square.svg">
</head>

<body>


<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-purple mb-4 shadow-sm">
  <a class="navbar-brand" href="/">
    <img src="assets/images/vertx-square.svg" alt="Vert.x" width="40" height="40">
    &nbsp; Eclipse Vert.x how-to
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
    aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://vertx.io/docs/"><i class="fas fa-lg fa-drafting-compass"></i> Vert.x docs</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/"><i class="fab fa-lg fa-github"></i> Source
          code</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com//edit/master/README.adoc"><i
            class="far fa-lg fa-edit"></i>
          Edit this</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container">

  <div class="row">
    <div class="col">
      <h1>Vert.x FIDO2 webauthn for web applications</h1>
      <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what-you-will-build">What you will build</a></li>
<li><a href="#what-you-need">What you need</a></li>
<li><a href="#create-a-project">Create a project</a></li>
<li><a href="#security-first">Security first</a></li>
<li><a href="#registration-flow">Registration Flow</a></li>
<li><a href="#authentication-flow">Authentication Flow</a></li>
<li><a href="#writing-the-server-code">Writing the server code</a>
<ul class="sectlevel2">
<li><a href="#handling-authenticator-objects">Handling Authenticator Objects</a></li>
<li><a href="#configure-the-webauthn-object">Configure the Webauthn Object</a></li>
<li><a href="#web-router-initialization">Web router initialization</a></li>
<li><a href="#server-boostrap">Server boostrap</a></li>
</ul>
</li>
<li><a href="#writing-the-client-code">Writing the client code</a>
<ul class="sectlevel2">
<li><a href="#the-client-script-code">The client script code</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#see-also">See also</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This how to will show you how to build and secure a simple <a href="https://github.com/herrjemand/awesome-webauthn#server-libs">FIDO2 CONFORMANT</a> (commonly known as Web Authentication API) vert.x web application. The Web Authentication API (also known as WebAuthn) is a specification written by the W3C and FIDO Alliance, with the participation of Google, Mozilla, Microsoft, Yubico, and others. The API allows servers to register and authenticate users using public key cryptography instead of a password.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-build">What you will build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By the end of this how-to, you will have a working application that requires or stores passwords to perform authentication. This will be achieved with WebAuthn, which is a new W3C global standard for secure authentication on the Web supported by all leading browsers and platforms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-need">What you need</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>A text editor or IDE</p>
</li>
<li>
<p>Java 8 or higher (11 or &gt;=15 recommended for the extra security algorithms)</p>
</li>
<li>
<p>Internet access</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-project">Create a project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go to start.vertx.io and <a href="https://start.vertx.io/starter.zip?groupId=howto&amp;artifactId=oauth-oidc&amp;vertxDependencies=vertx-web&amp;vertx-auth-webauthn">create a project</a> with the following dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vert.x Web</p>
</li>
<li>
<p>Webauthn Auth</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="project.png" alt="project" width="600">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-first">Security first</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Web Authentication API is a secure API and vendors decided to follow the best practices. While you can build a server without using SSL, modern web browsers will not connect or allow the usage of the webauthn APIs with servers not using SSL, even during development.</p>
</div>
<div class="paragraph">
<p>Before we can start using webauthn we will need to ensure that even our development application is SSL ready. For this we need to create a valid SSL certificate. Do note that self signed certificates are still allowed:</p>
</div>
<div class="paragraph">
<p>To create a self-signed certificate for your IP address do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">IP</span><span style="color: #000000;font-weight: bold">=</span>10.0.0.2
<span style="color: #0086B3">export </span><span style="color: #008080">CERTSTORE_SECRET</span><span style="color: #000000;font-weight: bold">=</span>password    # <b class="conum">(1)</b>
keytool <span style="color: #d14">\</span>
  <span style="color: #000080">-genkeypair</span> <span style="color: #d14">\</span>
  <span style="color: #000080">-alias</span> rsakey <span style="color: #d14">\</span>
  <span style="color: #000080">-keyalg</span> rsa <span style="color: #d14">\</span>
  <span style="color: #000080">-storepass</span> <span style="color: #000000;font-weight: bold">${</span><span style="color: #008080">CERTSTORE_SECRET</span><span style="color: #000000;font-weight: bold">}</span> <span style="color: #d14">\</span>
  <span style="color: #000080">-keystore</span> certstore.jks <span style="color: #d14">\</span>
  <span style="color: #000080">-storetype</span> JKS <span style="color: #d14">\</span>
  <span style="color: #000080">-dname</span> <span style="color: #d14">"CN=</span><span style="color: #000000;font-weight: bold">${</span><span style="color: #008080">IP</span><span style="color: #000000;font-weight: bold">}</span><span style="color: #d14">.nip.io,O=Vert.x Development"</span> # <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Don&#8217;t use this password!</p>
</li>
<li>
<p>replace the CN with your own IP address (other than localhost) with suffix <code>.nip.io</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For this setup we&#8217;re relying on a free DNS server that returns your IP address when queried. Other services exist in the web that provide the same results, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://sslip.io/" class="bare">https://sslip.io/</a></p>
</li>
<li>
<p><a href="https://xip.io/" class="bare">https://xip.io/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this moment we have a SSL certificate, however the format is considered deprecated for modern Java versions, so we need a second step to convert it to <code>PKCS#12</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">keytool <span style="color: #d14">\</span>
  <span style="color: #000080">-importkeystore</span> <span style="color: #d14">\</span>
  <span style="color: #000080">-srckeystore</span> certstore.jks <span style="color: #d14">\</span>
  <span style="color: #000080">-destkeystore</span> certstore.jks <span style="color: #d14">\</span>
  <span style="color: #000080">-deststoretype</span> pkcs12</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your new SSL certificate is on the file <code>certstore.jks</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registration-flow">Registration Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before being able to <em>login</em> to your application we will need to register an FIDO2 authenticator. This process is similar to a "sign-up" flow in web application. There are however a few differences that this diagram tries to illustrate:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="register-flow.jpg" alt="register flow">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User registers using just a <strong>username</strong></p>
</li>
<li>
<p>Your server (Relying Party) creates a secure challenge</p>
</li>
<li>
<p>The browser will pass this information to the token device</p>
</li>
<li>
<p>The token generates a new key pair for this information</p>
</li>
<li>
<p>The challenge is signed and returned to the server (RP)</p>
</li>
<li>
<p>The server verifies that the challenge is correct and stores the public key</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="authentication-flow">Authentication Flow</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="authn-flow.jpg" alt="authn flow">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User authenticates using just a <strong>username</strong></p>
</li>
<li>
<p>Your server (Relying Party) creates a secure challenge</p>
</li>
<li>
<p>The browser will pass this information to the token device</p>
</li>
<li>
<p>The token generates verifies the credential and signs the challenge</p>
</li>
<li>
<p>The browser creates an authentication assertion</p>
</li>
<li>
<p>The server verifies that the assertion is correct and allows the user</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-server-code">Writing the server code</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="handling-authenticator-objects">Handling Authenticator Objects</h3>
<div class="paragraph">
<p>You can find the full source code <a href="src/main/java/howto/fido2/MainVerticle.java">here</a>, for now let&#8217;s just cover important parts.</p>
</div>
<div class="paragraph">
<p>In order to have some working registration and authentication we need to be able to store and query authenticator data. For this we need to provide a few functions that do exactly this job. You can check it&#8217;s source code <a href="src/main/java/howto/fido2/InMemoryStore.java">here</a>. In your verticle you start by creating this object as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java">    <span style="color: #999988;font-style: italic">// Dummy database, real world workloads</span>
    <span style="color: #999988;font-style: italic">// use a persistent store or course!</span>
    <span style="color: #445588;font-weight: bold">InMemoryStore</span> <span style="background-color: #f8f8f8">database</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">InMemoryStore</span><span style="color: #000000;font-weight: bold">();</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-the-webauthn-object">Configure the Webauthn Object</h3>
<div class="paragraph">
<p>In order to use FIDO2 we need to configure how the authentication provider shall work. For this we need to create and configure an <code>WebAuthn</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java">    <span style="color: #999988;font-style: italic">// create the webauthn security object</span>
    <span style="color: #445588;font-weight: bold">WebAuthn</span> <span style="background-color: #f8f8f8">webAuthN</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #445588;font-weight: bold">WebAuthn</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">(</span>
      <span style="background-color: #f8f8f8">vertx</span><span style="color: #000000;font-weight: bold">,</span>
      <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">WebAuthnOptions</span><span style="color: #000000;font-weight: bold">()</span>   // <b class="conum">(1)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setRelyingParty</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">RelyingParty</span><span style="color: #000000;font-weight: bold">()</span>
          <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setName</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"Vert.x FIDO2/webauthn Howto"</span><span style="color: #000000;font-weight: bold">))</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setUserVerification</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">UserVerification</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">DISCOURAGED</span><span style="color: #000000;font-weight: bold">)</span>  // <b class="conum">(2)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setAttestation</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Attestation</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">NONE</span><span style="color: #000000;font-weight: bold">)</span>   // <b class="conum">(3)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setRequireResidentKey</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">false</span><span style="color: #000000;font-weight: bold">)</span>   // <b class="conum">(4)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setChallengeLength</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">64</span><span style="color: #000000;font-weight: bold">)</span>   // <b class="conum">(5)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addPubKeyCredParam</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">PublicKeyCredential</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">ES256</span><span style="color: #000000;font-weight: bold">)</span>    // <b class="conum">(6)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addPubKeyCredParam</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">PublicKeyCredential</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">RS256</span><span style="color: #000000;font-weight: bold">)</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addTransport</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">AuthenticatorTransport</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">USB</span><span style="color: #000000;font-weight: bold">)</span>   // <b class="conum">(7)</b>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addTransport</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">AuthenticatorTransport</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">NFC</span><span style="color: #000000;font-weight: bold">)</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addTransport</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">AuthenticatorTransport</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">BLE</span><span style="color: #000000;font-weight: bold">)</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">addTransport</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">AuthenticatorTransport</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">INTERNAL</span><span style="color: #000000;font-weight: bold">))</span>
      <span style="color: #999988;font-style: italic">// where to load/update authenticators data</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">authenticatorFetcher</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #990000;font-weight: bold">database:</span><span style="color: #000000;font-weight: bold">:</span><span style="background-color: #f8f8f8">fetcher</span><span style="color: #000000;font-weight: bold">)</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">authenticatorUpdater</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #990000;font-weight: bold">database:</span><span style="color: #000000;font-weight: bold">:</span><span style="background-color: #f8f8f8">updater</span><span style="color: #000000;font-weight: bold">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>All configuration happens in the <code>WebAuthnOptions</code>. This is just a small example of sensible defaults, consult the javadocs for even more options.</p>
</li>
<li>
<p>When verifying users we do not really require then to be verified.</p>
</li>
<li>
<p>During registration we don&#8217;t want to attest the hardware.</p>
</li>
<li>
<p>We don&#8217;t need resident keys for users to authenticate.</p>
</li>
<li>
<p>Define the length of a challenge, the minimum is <code>32</code>.</p>
</li>
<li>
<p>Which security algorithms do we accept.</p>
</li>
<li>
<p>What kind of transports do we allow from the browser to the authenticator.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="web-router-initialization">Web router initialization</h3>
<div class="paragraph">
<p>Let&#8217;s start configuring our HTTP routes to be secure. Before you can use FIDO2 there are a few handlers that <strong>ALWAYS</strong> need to be in place:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BodyHandler</p>
</li>
<li>
<p>SessionHandler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also recommended to have <code>StaticHandler</code> because the whole process requires both vert.x code (the one we&#8217;re currently exploring) and a small helper <code>JavaScript</code> script. To simplify development such helper is also provided by vert.x just by using a maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="xml">  <span style="color: #000080">&lt;dependencies&gt;</span>
    <span style="color: #000080">&lt;dependency&gt;</span>
      <span style="color: #000080">&lt;groupId&gt;</span>io.vertx<span style="color: #000080">&lt;/groupId&gt;</span>
      <span style="color: #000080">&lt;artifactId&gt;</span>vertx-web<span style="color: #000080">&lt;/artifactId&gt;</span>
    <span style="color: #000080">&lt;/dependency&gt;</span>
    <span style="color: #000080">&lt;dependency&gt;</span>
      <span style="color: #000080">&lt;groupId&gt;</span>io.vertx<span style="color: #000080">&lt;/groupId&gt;</span>
      <span style="color: #000080">&lt;artifactId&gt;</span>vertx-auth-webauthn<span style="color: #000080">&lt;/artifactId&gt;</span>
    <span style="color: #000080">&lt;/dependency&gt;</span>
    <span style="color: #000080">&lt;dependency&gt;</span>    &lt;!--<b class="conum">(1)</b>--&gt;
      <span style="color: #000080">&lt;groupId&gt;</span>io.vertx<span style="color: #000080">&lt;/groupId&gt;</span>
      <span style="color: #000080">&lt;artifactId&gt;</span>vertx-auth-webauthn<span style="color: #000080">&lt;/artifactId&gt;</span>
      <span style="color: #000080">&lt;version&gt;</span>${vertx.version}<span style="color: #000080">&lt;/version&gt;</span>
      <span style="color: #000080">&lt;classifier&gt;</span>client<span style="color: #000080">&lt;/classifier&gt;</span>
      <span style="color: #000080">&lt;type&gt;</span>js<span style="color: #000080">&lt;/type&gt;</span>
    <span style="color: #000080">&lt;/dependency&gt;</span>
  <span style="color: #000080">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provided simple helper script to interact with the vert.x backend.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now we can initialize the web router as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java">    <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">Router</span> <span style="background-color: #f8f8f8">app</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #445588;font-weight: bold">Router</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">router</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">vertx</span><span style="color: #000000;font-weight: bold">);</span>
    <span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">route</span><span style="color: #000000;font-weight: bold">()</span>   // <b class="conum">(1)</b>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">handler</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">StaticHandler</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">());</span>
    <span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">post</span><span style="color: #000000;font-weight: bold">()</span>    // <b class="conum">(2)</b>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">handler</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">BodyHandler</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">());</span>
    <span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">route</span><span style="color: #000000;font-weight: bold">()</span>   // <b class="conum">(3)</b>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">handler</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">SessionHandler</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">LocalSessionStore</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">vertx</span><span style="color: #000000;font-weight: bold">)));</span>

    <span style="color: #445588;font-weight: bold">WebAuthnHandler</span> <span style="background-color: #f8f8f8">webAuthnHandler</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #445588;font-weight: bold">WebAuthnHandler</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">create</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">webAuthN</span><span style="color: #000000;font-weight: bold">)</span> // <b class="conum">(4)</b>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setOrigin</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">format</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"https://%s.nip.io:8443"</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">getenv</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"IP"</span><span style="color: #000000;font-weight: bold">)))</span>
      <span style="color: #999988;font-style: italic">// required callback</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setupCallback</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">post</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/webauthn/callback"</span><span style="color: #000000;font-weight: bold">))</span>
      <span style="color: #999988;font-style: italic">// optional register callback</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setupCredentialsCreateCallback</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">post</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/webauthn/register"</span><span style="color: #000000;font-weight: bold">))</span>
      <span style="color: #999988;font-style: italic">// optional login callback</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setupCredentialsGetCallback</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">post</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/webauthn/login"</span><span style="color: #000000;font-weight: bold">));</span>

    <span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">route</span><span style="color: #000000;font-weight: bold">()</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">handler</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">webAuthnHandler</span><span style="color: #000000;font-weight: bold">);</span>

    <span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">route</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/protected"</span><span style="color: #000000;font-weight: bold">)</span>   // <b class="conum">(5)</b>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">handler</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">ctx</span> <span style="color: #000000;font-weight: bold">-&gt;</span>
        <span style="background-color: #f8f8f8">ctx</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">response</span><span style="color: #000000;font-weight: bold">()</span>
          <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">end</span><span style="color: #000000;font-weight: bold">(</span>
            <span style="color: #d14">"FIDO2 is Awesome!\n"</span> <span style="color: #000000;font-weight: bold">+</span>
              <span style="color: #d14">"No Password phishing here!\n"</span><span style="color: #000000;font-weight: bold">));</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Serve the client side application (more on this later).</p>
</li>
<li>
<p>Enable parsing of POST request body.</p>
</li>
<li>
<p>Enable sessions.</p>
</li>
<li>
<p>Mount the webauthn handler using the config defined previously.</p>
</li>
<li>
<p>Example secure route.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="server-boostrap">Server boostrap</h3>
<div class="paragraph">
<p>Now that we have a minimal router we need to create a HTTPS server. Note that this is a required step and the reason why we created a self-signed certificate and use a custom domain name for our development environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java">    <span style="background-color: #f8f8f8">vertx</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">createHttpServer</span><span style="color: #000000;font-weight: bold">(</span>
      <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">HttpServerOptions</span><span style="color: #000000;font-weight: bold">()</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setSsl</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">true</span><span style="color: #000000;font-weight: bold">)</span>
        <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setKeyStoreOptions</span><span style="color: #000000;font-weight: bold">(</span>
          <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">JksOptions</span><span style="color: #000000;font-weight: bold">()</span>
            <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setPath</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"certstore.jks"</span><span style="color: #000000;font-weight: bold">)</span>
            <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">setPassword</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">getenv</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"CERTSTORE_SECRET"</span><span style="color: #000000;font-weight: bold">))))</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">requestHandler</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">app</span><span style="color: #000000;font-weight: bold">)</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">listen</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">8443</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #d14">"0.0.0.0"</span><span style="color: #000000;font-weight: bold">)</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">onSuccess</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">v</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #000000;font-weight: bold">{</span>
        <span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">printf</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"Server: https://%s.nip.io:8443%n"</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">getenv</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"IP"</span><span style="color: #000000;font-weight: bold">));</span>
        <span style="background-color: #f8f8f8">start</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">complete</span><span style="color: #000000;font-weight: bold">();</span>
      <span style="color: #000000;font-weight: bold">})</span>
      <span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">onFailure</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #990000;font-weight: bold">start:</span><span style="color: #000000;font-weight: bold">:</span><span style="background-color: #f8f8f8">fail</span><span style="color: #000000;font-weight: bold">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this moment our backend application is complete and the route <code>/protected</code> shall be secure by FIDO2. Running the application as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">IP</span><span style="color: #000000;font-weight: bold">=</span>10.0.0.2 <span style="color: #d14">\</span>
mvn <span style="color: #0086B3">exec</span>:java

<span style="color: #999988;font-style: italic"># The following line should be present in your console:</span>
<span style="color: #999988;font-style: italic"># Server listening at: https://10.0.0.2.nip.io:8443</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is normal that your browser will given you an warning about the self-signed certificate:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="selfsigned.png" alt="selfsigned" width="600">
</div>
</div>
<div class="paragraph">
<p>This is for your protection. In a real world application you should use a proper SSL certificate such as the ones issued by let&#8217;s encrypt.</p>
</div>
<div class="paragraph">
<p>Navigating with your browser to: <code><a href="https://10.0.0.2.nip.io:8443/protected" class="bare">https://10.0.0.2.nip.io:8443/protected</a></code> should render a <code>Forbidden</code> error. The next step is to create a minimal login and registration web application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-client-code">Writing the client code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the client application, no framework is going to be used in order to show that the script can be used with any framework or without.</p>
</div>
<div class="paragraph">
<p>We will create a minimal HTML page with 3 sections:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a form where users can register or login by just entering their:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Display Name</strong>: For example a user friendly name such as "John Doe"</p>
</li>
<li>
<p><strong>Username</strong>: An unique username such as "<a href="mailto:john.doe@mail.com">john.doe@mail.com</a>"</p>
</li>
</ul>
</div>
</li>
<li>
<p>Buttons to <strong>register</strong> and <strong>login</strong></p>
</li>
<li>
<p>A link to the protected resource, only after register <strong>AND</strong> login should be allowed.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="html"><span style="color: #999999;font-weight: bold">&lt;!DOCTYPE html&gt;</span>
<span style="color: #000080">&lt;html</span> <span style="color: #008080">lang=</span><span style="color: #d14">"en"</span><span style="color: #000080">&gt;</span>
<span style="color: #000080">&lt;head&gt;</span>
  <span style="color: #000080">&lt;meta</span> <span style="color: #008080">charset=</span><span style="color: #d14">"utf-8"</span><span style="color: #000080">/&gt;</span>
  <span style="color: #000080">&lt;title&gt;</span>WebAuthn Howto<span style="color: #000080">&lt;/title&gt;</span>
<span style="color: #000080">&lt;/head&gt;</span>
<span style="color: #000080">&lt;body&gt;</span>
<span style="color: #000080">&lt;noscript&gt;</span>You need to enable JavaScript to run this app.<span style="color: #000080">&lt;/noscript&gt;</span>

<span style="color: #000080">&lt;div</span> <span style="color: #008080">id=</span><span style="color: #d14">"message"</span><span style="color: #000080">&gt;&lt;/div&gt;</span>
<span style="color: #000080">&lt;div&gt;</span> &lt;!--<b class="conum">(1)</b>--&gt;
  <span style="color: #000080">&lt;label</span> <span style="color: #008080">for=</span><span style="color: #d14">"displayName"</span><span style="color: #000080">&gt;</span>Display Name: <span style="color: #000080">&lt;/label&gt;</span>
  <span style="color: #000080">&lt;input</span> <span style="color: #008080">id=</span><span style="color: #d14">"displayName"</span> <span style="color: #008080">name=</span><span style="color: #d14">"displayName"</span> <span style="color: #008080">type=</span><span style="color: #d14">"text"</span> <span style="color: #008080">value=</span><span style="color: #d14">"Your Name"</span><span style="color: #000080">&gt;&lt;br/&gt;</span>
  <span style="color: #000080">&lt;label</span> <span style="color: #008080">for=</span><span style="color: #d14">"username"</span><span style="color: #000080">&gt;</span>Username: <span style="color: #000080">&lt;/label&gt;</span>
  <span style="color: #000080">&lt;input</span> <span style="color: #008080">id=</span><span style="color: #d14">"username"</span> <span style="color: #008080">name=</span><span style="color: #d14">"username"</span> <span style="color: #008080">type=</span><span style="color: #d14">"email"</span> <span style="color: #008080">value=</span><span style="color: #d14">"me@server.com"</span><span style="color: #000080">&gt;</span>
<span style="color: #000080">&lt;/div&gt;</span>
<span style="color: #000080">&lt;hr&gt;</span>
<span style="color: #000080">&lt;div&gt;</span> &lt;!--<b class="conum">(2)</b>--&gt;
  <span style="color: #000080">&lt;button</span> <span style="color: #008080">id=</span><span style="color: #d14">"register"</span><span style="color: #000080">&gt;</span>register<span style="color: #000080">&lt;/button&gt;</span>
  <span style="color: #000080">&lt;button</span> <span style="color: #008080">id=</span><span style="color: #d14">"login"</span><span style="color: #000080">&gt;</span>login<span style="color: #000080">&lt;/button&gt;</span>
<span style="color: #000080">&lt;/div&gt;</span>
<span style="color: #000080">&lt;hr&gt;</span>
<span style="color: #000080">&lt;div&gt;</span> &lt;!--<b class="conum">(3)</b>--&gt;
  <span style="color: #000080">&lt;a</span> <span style="color: #008080">href=</span><span style="color: #d14">"/protected"</span><span style="color: #000080">&gt;</span>Want some secret info?<span style="color: #000080">&lt;/a&gt;</span>
<span style="color: #000080">&lt;/div&gt;</span>

<span style="color: #000080">&lt;script </span><span style="color: #008080">src=</span><span style="color: #d14">"vertx-auth-webauthn-client.js"</span><span style="color: #000080">&gt;&lt;/script&gt;</span>   &lt;!--<b class="conum">(4)</b>--&gt;
<span style="color: #000080">&lt;script </span><span style="color: #008080">src=</span><span style="color: #d14">"main.js"</span><span style="color: #000080">&gt;&lt;/script&gt;</span>   &lt;!--<b class="conum">(5)</b>--&gt;
<span style="color: #000080">&lt;/body&gt;</span>
<span style="color: #000080">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The first section as described above.</p>
</li>
<li>
<p>The second section as described above.</p>
</li>
<li>
<p>The third section as described above.</p>
</li>
<li>
<p>Helper script added to the project dependencies</p>
</li>
<li>
<p>Your application script</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="the-client-script-code">The client script code</h3>
<div class="paragraph">
<p>You can check the full script <a href="src/main/resources/webroot/main.js">here</a>. Let&#8217;s just cover the important sections.</p>
</div>
<div class="paragraph">
<p>The included script <code>vertx-auth-webauthn-client.js</code> defines a global type <code>WebAuthn</code>. The first step is to create an instance of this object and configure it to match our backend configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">webAuthn</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="background-color: #f8f8f8">WebAuthn</span><span style="background-color: #f8f8f8">({</span>
  <span style="color: #008080">callbackPath</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">'</span><span style="color: #d14">/webauthn/callback</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #008080">registerPath</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">'</span><span style="color: #d14">/webauthn/register</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #008080">loginPath</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">'</span><span style="color: #d14">/webauthn/login</span><span style="color: #d14">'</span>
<span style="background-color: #f8f8f8">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration should be straightforward, only define the paths that match your backend routes.</p>
</div>
<div class="paragraph">
<p>Next we need to add event handlers to our buttons. We start with the register action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">registerButton</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">onclick</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
  <span style="background-color: #f8f8f8">webAuthn</span>
    <span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">register</span><span style="background-color: #f8f8f8">({</span>
      <span style="color: #008080">name</span><span style="background-color: #f8f8f8">:</span> <span style="color: #0086B3">document</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">getElementById</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">username</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">).</span><span style="background-color: #f8f8f8">value</span><span style="background-color: #f8f8f8">,</span>
      <span style="color: #008080">displayName</span><span style="background-color: #f8f8f8">:</span> <span style="color: #0086B3">document</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">getElementById</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">displayName</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">).</span><span style="background-color: #f8f8f8">value</span>
    <span style="background-color: #f8f8f8">})</span>
    <span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">then</span><span style="background-color: #f8f8f8">(()</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
      <span style="background-color: #f8f8f8">displayMessage</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">registration successful</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">})</span>
    <span style="background-color: #f8f8f8">.</span><span style="color: #000000;font-weight: bold">catch</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">err</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
      <span style="background-color: #f8f8f8">displayMessage</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">registration failed</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">);</span>
      <span style="background-color: #f8f8f8">console</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">error</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">err</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onclick</code> event will just use the <code>Webauthn</code> object. The webauthn object has only 2 method and it&#8217;s <code>Promise</code> based to it should not be hard to grasp for vert.x users. If you&#8217;re mainly a <code>Java</code> vert.x developer, just think of a <code>JavaScript</code> Promise as a vert.x <code>Future</code> and everything should be very similar.</p>
</div>
<div class="paragraph">
<p>To register a user there are just 2 required properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>name</code> the unique username, for example, an email address.</p>
</li>
<li>
<p><code>displayName</code> a human friendly text description, for example, your first and last name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Filling the form and clicking the register button, the user should be presented with a popup asking to authorize the registration:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="register-start.png" alt="register start" width="600">
</div>
</div>
<div class="paragraph">
<p>After you touch your authenticator the flow should complete successfully with:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="register-end.png" alt="register end" width="600">
</div>
</div>
<div class="paragraph">
<p>At this moment you can close your browser or even open a different one. The sign-up process is complete so you can now login from anywhere with your token.</p>
</div>
<div class="paragraph">
<p>We now need to handle the <code>onclick</code> event for the login button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">loginButton</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">onclick</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
  <span style="background-color: #f8f8f8">webAuthn</span>
    <span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">login</span><span style="background-color: #f8f8f8">({</span>
      <span style="color: #008080">name</span><span style="background-color: #f8f8f8">:</span> <span style="color: #0086B3">document</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">getElementById</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">username</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">).</span><span style="background-color: #f8f8f8">value</span>
    <span style="background-color: #f8f8f8">})</span>
    <span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">then</span><span style="background-color: #f8f8f8">(()</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
      <span style="background-color: #f8f8f8">displayMessage</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">You are logged in</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">})</span>
    <span style="background-color: #f8f8f8">.</span><span style="color: #000000;font-weight: bold">catch</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">err</span> <span style="color: #000000;font-weight: bold">=&gt;</span> <span style="background-color: #f8f8f8">{</span>
      <span style="background-color: #f8f8f8">displayMessage</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">'</span><span style="color: #d14">Invalid credential</span><span style="color: #d14">'</span><span style="background-color: #f8f8f8">);</span>
      <span style="background-color: #f8f8f8">console</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">error</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">err</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like the FIDO2 describes, using webauthn is a passwordless authentication, so the only required field to perform the login is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>name</code> the unique username, for example, an email address.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="login-start.png" alt="login start" width="600">
</div>
</div>
<div class="paragraph">
<p>Just like in the registration screen a popup will be presented telling you that there is an intent to login and asks the user for authorization. When you touch your authenticator you can see:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="login-end.png" alt="login end" width="600">
</div>
</div>
<div class="paragraph">
<p>Now that you&#8217;re logged in, you can finally try to see the secret info link, which shall give your something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="secret.png" alt="secret" width="600">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this how-to we covered:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creating a web project</p>
</li>
<li>
<p>Secure a web application with Webauthn</p>
</li>
<li>
<p>Write the client side code with the help of webauthn-client.js</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>I hope you now can use FIDO2/webauthn on your next project!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also">See also</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://vertx.io/docs/vertx-core/java/">The Vert.x core APIs documentation</a></p>
</li>
<li>
<p><a href="https://vertx.io/docs/vertx-web/java/">The Vert.x web documentation</a></p>
</li>
<li>
<p><a href="https://vertx.io/docs/vertx-auth-webauthn/java/">The Vert.x Webauthn documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <!-- Sharingbutton Facebook -->
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https://vertx-howtos.github.io/fido2-webauthn-howto" target="_blank"
    rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton Twitter -->
<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Vert.x%20FIDO2%20webauthn%20for%20web%20applications&amp;url=https://vertx-howtos.github.io/fido2-webauthn-howto"
    target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton E-Mail -->
<a class="resp-sharing-button__link" href="mailto:?subject=Vert.x%20FIDO2%20webauthn%20for%20web%20applications&amp;body=https://vertx-howtos.github.io/fido2-webauthn-howto" target="_self" rel="noopener"
    aria-label="">
    <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton LinkedIn -->
<a class="resp-sharing-button__link"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://vertx-howtos.github.io/fido2-webauthn-howto&amp;title=Vert.x%20FIDO2%20webauthn%20for%20web%20applications&amp;summary=Vert.x%20FIDO2%20webauthn%20for%20web%20applications&amp;source=https://vertx-howtos.github.io/fido2-webauthn-howto"
    target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton Reddit -->
<a class="resp-sharing-button__link"
    href="https://reddit.com/submit/?url=https://vertx-howtos.github.io/fido2-webauthn-howto&amp;resubmit=true&amp;title=Vert.x%20FIDO2%20webauthn%20for%20web%20applications" target="_blank" rel="noopener"
    aria-label="">
    <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton WhatsApp -->
<a class="resp-sharing-button__link" href="whatsapp://send?text=Vert.x%20FIDO2%20webauthn%20for%20web%20applications%20https://vertx-howtos.github.io/fido2-webauthn-howto" target="_blank" rel="noopener"
    aria-label="">
    <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3 0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7 0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1 0-5.2 4.2-9.4 9.4-9.4 2.5 0 4.9 1 6.7 2.8 1.8 1.8 2.8 4.2 2.8 6.7-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2-.2-.3 0-.5.1-.6s.3-.3.4-.5c.2-.1.3-.3.4-.5.1-.2 0-.4 0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z" />
                </svg>
        </div>
    </div>
</a>

<!-- Sharingbutton Telegram -->
<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Vert.x%20FIDO2%20webauthn%20for%20web%20applications&amp;url=https://vertx-howtos.github.io/fido2-webauthn-howto"
    target="_blank" rel="noopener" aria-label="">
    <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small">
        <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M.707 8.475C.275 8.64 0 9.508 0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102 0 0 0 1.75.527l2.96-2.41a.405.405 0 0 1 .494-.013l5.34 3.87a1.1 1.1 0 0 0 1.046.135 1.1 1.1 0 0 0 .682-.803l3.91-18.795A1.102 1.102 0 0 0 22.5.075L.706 8.475z" />
                </svg>
        </div>
    </div>
</a>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <hr>
      <p><small>Last published: 2021-07-11 00:58:38 +0000.</small></p>
    </div>
  </div>
</div>

<script>
  (function () {
    const blocks = document.getElementsByClassName("collapsed");
    for (let i = 0; i < blocks.length; i++) {
      const block = blocks[i];
      const blockWrapper = document.createElement("div");
      const details = document.createElement("details");
      const summary = document.createElement("summary");
      summary.innerHTML = "Details <em>(click to expand)</em>";
      details.appendChild(summary);
      details.appendChild(blockWrapper);
      block.parentNode.insertBefore(details, block);
      blockWrapper.appendChild(block);
    }
  })();
</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
    crossorigin="anonymous"></script>
</body>

</html>